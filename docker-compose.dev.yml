# Docker Compose for Development (SQLite)
# Usage: docker-compose -f docker-compose.dev.yml up

version: "3.8"

services:
  tg_parser:
    build:
      context: .
      dockerfile: Dockerfile
    image: tg_parser:dev
    container_name: tg_parser_dev
    volumes:
      # Mount data directory for SQLite databases
      - ./data:/app/data
      # Mount .env file (read-only)
      - ./.env:/app/.env:ro
      # Mount prompts directory (read-only) for custom prompts
      - ./prompts:/app/prompts:ro
      # Optional: mount session file for Telegram auth persistence
      - ./tg_parser_session.session:/app/tg_parser_session.session
      # Mount source code for live editing (development)
      - ./tg_parser:/app/tg_parser:ro
    environment:
      # Database Configuration (Development: SQLite)
      - DB_TYPE=sqlite
      - INGESTION_STATE_DB_PATH=/app/data/ingestion_state.sqlite
      - RAW_STORAGE_DB_PATH=/app/data/raw_storage.sqlite
      - PROCESSING_STORAGE_DB_PATH=/app/data/processing_storage.sqlite
      
      # LLM Provider
      - LLM_PROVIDER=${LLM_PROVIDER:-openai}
      - LLM_MODEL=${LLM_MODEL:-gpt-4o-mini}
      
      # API Keys
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      
      # Telegram credentials
      - TELEGRAM_API_ID=${TELEGRAM_API_ID}
      - TELEGRAM_API_HASH=${TELEGRAM_API_HASH}
      - TELEGRAM_PHONE=${TELEGRAM_PHONE}
      
      # Logging (Development: human-readable)
      - LOG_FORMAT=text
      - LOG_LEVEL=DEBUG
    
    command: ["--help"]
    stop_grace_period: 30s
    networks:
      - tg_parser_dev_network

  # Optional: Ollama service for local LLM
  ollama:
    image: ollama/ollama:latest
    container_name: tg_parser_ollama_dev
    ports:
      - "11434:11434"
    volumes:
      - ollama_dev_data:/root/.ollama
    networks:
      - tg_parser_dev_network

volumes:
  ollama_dev_data:
    name: tg_parser_ollama_dev_data

networks:
  tg_parser_dev_network:
    name: tg_parser_dev_network
    driver: bridge


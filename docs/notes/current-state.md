# –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ TG_parser

**–î–∞—Ç–∞**: 26 –¥–µ–∫–∞–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è**: v1.1.0  
**–°—Ç–∞—Ç—É—Å**: Production-ready, –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏ v1.1 –≤—ã–ø–æ–ª–Ω–µ–Ω—ã

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| **Tests** | 103 (100% pass) |
| **TODOs –≤ –∫–æ–¥–µ** | 0 ‚úÖ |
| **Success rate** | 99.76% (–Ω–∞ 846 —Å–æ–æ–±—â–µ–Ω–∏—è—Ö) |
| **Prompts in YAML** | 3 |

---

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (v1.0 + v1.1)

### Core Pipeline

- ‚úÖ **Ingestion Pipeline**: Telethon-based —Å–±–æ—Ä –∏–∑ Telegram
- ‚úÖ **Processing Pipeline**: LLM –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ **Topicization Pipeline**: –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –≤ —Ç–µ–º—ã
- ‚úÖ **Export System**: kb_entries.ndjson, topics.json, topic_*.json

### v1.1 Features

- ‚úÖ **Configurable Prompts (YAML)**: `prompts/` –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
- ‚úÖ **PromptLoader**: –ó–∞–≥—Ä—É–∑—á–∏–∫ —Å fallback –Ω–∞ defaults
- ‚úÖ **Auto-retry**: `--retry-failed` —Ñ–ª–∞–≥
- ‚úÖ **list_all()**: –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –∫–∞–Ω–∞–ª–æ–≤
- ‚úÖ **Channel usernames**: –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑ IngestionStateRepo
- ‚úÖ **Improved LLM validation**: Defaults –¥–ª—è optional –ø–æ–ª–µ–π

### CLI Commands

| –ö–æ–º–∞–Ω–¥–∞ | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|--------|----------|
| `init` | ‚úÖ | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö |
| `add-source` | ‚úÖ | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ |
| `ingest` | ‚úÖ | –°–±–æ—Ä raw —Å–æ–æ–±—â–µ–Ω–∏–π |
| `process` | ‚úÖ | –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ LLM |
| `topicize` | ‚úÖ | –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–º |
| `export` | ‚úÖ | –≠–∫—Å–ø–æ—Ä—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ |
| `run` | ‚úÖ | One-shot pipeline |

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
TG_parser/
‚îú‚îÄ‚îÄ tg_parser/
‚îÇ   ‚îú‚îÄ‚îÄ domain/           # Pydantic v2 –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ config/           # Pydantic-settings
‚îÇ   ‚îú‚îÄ‚îÄ storage/          # SQLite —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ports.py      # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ sqlite/       # –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ processing/       # LLM –æ–±—Ä–∞–±–æ—Ç–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pipeline.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ topicization.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ prompt_loader.py  # v1.1 NEW
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ llm/
‚îÇ   ‚îú‚îÄ‚îÄ ingestion/        # Telethon client
‚îÇ   ‚îú‚îÄ‚îÄ export/           # –≠–∫—Å–ø–æ—Ä—Ç
‚îÇ   ‚îî‚îÄ‚îÄ cli/              # Typer CLI
‚îú‚îÄ‚îÄ prompts/              # v1.1 NEW - YAML –ø—Ä–æ–º–ø—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ processing.yaml
‚îÇ   ‚îú‚îÄ‚îÄ topicization.yaml
‚îÇ   ‚îú‚îÄ‚îÄ supporting_items.yaml
‚îÇ   ‚îî‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ tests/                # 103 —Ç–µ—Å—Ç–∞
‚îú‚îÄ‚îÄ docs/                 # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îî‚îÄ‚îÄ output/               # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —ç–∫—Å–ø–æ—Ä—Ç–∞
```

---

## üöÄ Quick Start

```bash
# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ
source .venv/bin/activate

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑—ã
python -m tg_parser.cli init

# –î–æ–±–∞–≤–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫
python -m tg_parser.cli add-source \
    --source-id lab1 \
    --channel-id 1234567890 \
    --channel-username labdiagnostica

# One-shot pipeline
python -m tg_parser.cli run \
    --source lab1 \
    --out ./output

# Retry failed messages
python -m tg_parser.cli process \
    --channel 1234567890 \
    --retry-failed
```

---

## üìö –ö–ª—é—á–µ–≤—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

| –î–æ–∫—É–º–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| `CHANGELOG.md` | –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π |
| `docs/notes/SESSION_HANDOFF_v1.1.md` | Handoff –¥–ª—è v1.2 |
| `docs/architecture.md` | –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã |
| `docs/pipeline.md` | –î–µ—Ç–∞–ª–∏ pipeline |
| `prompts/README.md` | –§–æ—Ä–º–∞—Ç YAML –ø—Ä–æ–º–ø—Ç–æ–≤ |

---

## üîÑ –ß—Ç–æ –≥–æ—Ç–æ–≤–æ –¥–ª—è v1.2

1. **PromptLoader –≥–æ—Ç–æ–≤ –¥–ª—è Multi-LLM**:
   - `extended.gpt5` —Å–µ–∫—Ü–∏—è –≤ YAML
   - `extended.o1` —Å–µ–∫—Ü–∏—è –≤ YAML
   
2. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π**:
   - –†–∞–∑–Ω—ã–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
   - Model-specific –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

3. **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**:
   - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å PromptLoader –≤ pipeline.py
   - –î–æ–±–∞–≤–∏—Ç—å Claude support
   - –î–æ–±–∞–≤–∏—Ç—å CLI —Ñ–ª–∞–≥ `--prompts-dir`

---

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **PromptLoader –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω** ‚Äî –ø—Ä–æ–º–ø—Ç—ã –≤—Å—ë –µ—â—ë –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —á–µ—Ä–µ–∑ —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ pipeline.py
2. **CLI —Ñ–ª–∞–≥ `--prompts-dir`** ‚Äî –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
3. **Hot-reload –ø—Ä–æ–º–ø—Ç–æ–≤** ‚Äî —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫

---

## üìû –ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –Ω–æ–≤–æ–≥–æ —á–∞—Ç–∞

**–°–∫–∞–∂–∏—Ç–µ**:
> "–Ø –ø—Ä–æ–¥–æ–ª–∂–∞—é —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É TG_parser v1.2. –í–µ—Ä—Å–∏—è v1.1 –≥–æ—Ç–æ–≤–∞: PromptLoader —Å–æ–∑–¥–∞–Ω, YAML –ø—Ä–æ–º–ø—Ç—ã –µ—Å—Ç—å, –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç. –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥ ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è PromptLoader –≤ pipeline.py –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ Multi-LLM –ø–æ–¥–¥–µ—Ä–∂–∫–∏ (Claude). –î–µ—Ç–∞–ª–∏ –≤ `docs/notes/SESSION_HANDOFF_v1.1.md`."

**–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ**:
- `docs/notes/SESSION_HANDOFF_v1.1.md`
- `DEVELOPMENT_ROADMAP.md`
- `prompts/README.md`

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 26 –¥–µ–∫–∞–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è**: v1.1.0  
**–°–ª–µ–¥—É—é—â–∞—è –≤–µ—Ä—Å–∏—è**: v1.2 (Multi-LLM)

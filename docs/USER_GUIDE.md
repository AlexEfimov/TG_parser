# TG_parser ‚Äî –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–í–µ—Ä—Å–∏—è:** 3.0.0-alpha.3 (Agent Observability)

**TG_parser** ‚Äî —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —Å–±–æ—Ä–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏–∑ Telegram-–∫–∞–Ω–∞–ª–æ–≤, –æ–±—Ä–∞–±–æ—Ç–∫–∏ —á–µ—Ä–µ–∑ LLM –∏ —ç–∫—Å–ø–æ—Ä—Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è RAG-—Å–∏—Å—Ç–µ–º –∏ –±–∞–∑ –∑–Ω–∞–Ω–∏–π.

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∏-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
2. [CLI –∫–æ–º–∞–Ω–¥—ã](#cli-–∫–æ–º–∞–Ω–¥—ã)
3. [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
4. [Troubleshooting](#troubleshooting)

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Python 3.12+**
- **pip** –∏–ª–∏ **uv** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
- –ê–∫–∫–∞—É–Ω—Ç Telegram —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–æ–ª—É—á–∏—Ç—å API credentials
- API –∫–ª—é—á OpenAI

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repo-url>
cd TG_parser

# –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python3.12 -m venv .venv

# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ
source .venv/bin/activate  # macOS/Linux
# .venv\Scripts\activate   # Windows

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install --upgrade pip
pip install -r requirements.txt

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
pip install -e .
```

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ Telegram API credentials

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://my.telegram.org
2. –í–æ–π–¥–∏—Ç–µ —Å –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤–∞—à–µ–≥–æ Telegram-–∞–∫–∫–∞—É–Ω—Ç–∞
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª **"API development tools"**
4. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
   - **App title** ‚Äî –ª—é–±–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "TG Parser")
   - **Short name** ‚Äî –∫–æ—Ä–æ—Ç–∫–æ–µ –∏–º—è –ª–∞—Ç–∏–Ω–∏—Ü–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, "tgparser")
   - **Platform** ‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ "Desktop"
5. –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ:
   - `api_id` ‚Äî —á–∏—Å–ª–æ–≤–æ–π ID
   - `api_hash` ‚Äî —Å—Ç—Ä–æ–∫–∞ –∏–∑ –±—É–∫–≤ –∏ —Ü–∏—Ñ—Ä

> ‚ö†Ô∏è **–í–∞–∂–Ω–æ:** API credentials –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –≤–∞—à–µ–º—É –∞–∫–∫–∞—É–Ω—Ç—É. –ù–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –∏—Ö —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º.

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ LLM API (v1.2: Multi-LLM)

**TG_parser v1.2** –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç 4 LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞. –í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ:

#### OpenAI (default)
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://platform.openai.com/api-keys
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π API –∫–ª—é—á
3. –î–æ–±–∞–≤—å—Ç–µ –≤ `.env`: `OPENAI_API_KEY=sk-...`

#### Anthropic Claude
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://console.anthropic.com/
2. –°–æ–∑–¥–∞–π—Ç–µ API –∫–ª—é—á
3. –î–æ–±–∞–≤—å—Ç–µ –≤ `.env`: `ANTHROPIC_API_KEY=sk-ant-...`

#### Google Gemini
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://aistudio.google.com/apikey
2. –°–æ–∑–¥–∞–π—Ç–µ API –∫–ª—é—á
3. –î–æ–±–∞–≤—å—Ç–µ –≤ `.env`: `GEMINI_API_KEY=AI...`

#### Ollama (–ª–æ–∫–∞–ª—å–Ω—ã–π, –±–µ—Å–ø–ª–∞—Ç–Ω–æ)
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Ollama: https://ollama.ai
2. –°–∫–∞—á–∞–π—Ç–µ –º–æ–¥–µ–ª—å: `ollama pull qwen3:8b`
3. –î–æ–±–∞–≤—å—Ç–µ –≤ `.env`: `LLM_BASE_URL=http://localhost:11434`

> üí° **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
> - **Gemini** ‚Äî —Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π (0.34 msg/s), –æ—Ç–ª–∏—á–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Ü–µ–Ω–∞/–∫–∞—á–µ—Å—Ç–≤–æ
> - **Claude** ‚Äî –ª—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è entities
> - **Ollama** ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω–æ, –ø—Ä–∏–≤–∞—Ç–Ω–æ, –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```bash
cp .env.example .env
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env`:

```env
# Telegram API credentials (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
TELEGRAM_API_ID=12345678
TELEGRAM_API_HASH=abcdef1234567890abcdef1234567890
TELEGRAM_PHONE=+79001234567

# === LLM Configuration (v1.2: Multi-LLM) ===

# –ü—Ä–æ–≤–∞–π–¥–µ—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: openai | anthropic | gemini | ollama
LLM_PROVIDER=openai

# API –∫–ª—é—á–∏ (—É–∫–∞–∂–∏—Ç–µ –Ω—É–∂–Ω—ã–µ)
OPENAI_API_KEY=sk-...your-api-key...
ANTHROPIC_API_KEY=sk-ant-...your-key...
GEMINI_API_KEY=AI...your-key...

# –î–ª—è Ollama (–ª–æ–∫–∞–ª—å–Ω—ã–π LLM)
LLM_BASE_URL=http://localhost:11434

# –ú–æ–¥–µ–ª—å LLM (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, default –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞)
# LLM_MODEL=gpt-4o-mini
# LLM_MODEL=claude-sonnet-4-20250514
# LLM_MODEL=gemini-2.0-flash-exp
# LLM_MODEL=qwen3:8b
```

### –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –Ω–∞—Å—Ç—Ä–æ–µ–∫

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|----------|-------------|--------------|
| `TELEGRAM_API_ID` | Telegram API ID | –î–∞ | ‚Äî |
| `TELEGRAM_API_HASH` | Telegram API Hash | –î–∞ | ‚Äî |
| `TELEGRAM_PHONE` | –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ | –î–∞ | ‚Äî |
| `TELEGRAM_SESSION_NAME` | –ò–º—è —Ñ–∞–π–ª–∞ —Å–µ—Å—Å–∏–∏ | –ù–µ—Ç | `tg_parser_session` |
| `OPENAI_API_KEY` | API –∫–ª—é—á OpenAI | –î–∞ | ‚Äî |
| `LLM_MODEL` | –ú–æ–¥–µ–ª—å LLM | –ù–µ—Ç | `gpt-4o-mini` |
| `LLM_BASE_URL` | Base URL –¥–ª—è OpenAI-compatible API | –ù–µ—Ç | `https://api.openai.com/v1` |
| `LLM_TEMPERATURE` | Temperature –¥–ª—è LLM (0.0 = –¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º) | –ù–µ—Ç | `0.0` |
| `LLM_MAX_TOKENS` | –ú–∞–∫—Å–∏–º—É–º —Ç–æ–∫–µ–Ω–æ–≤ –æ—Ç–≤–µ—Ç–∞ | –ù–µ—Ç | `4096` |
| `PROCESSING_MAX_ATTEMPTS_PER_MESSAGE` | –ú–∞–∫—Å. –ø–æ–ø—ã—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è | –ù–µ—Ç | `3` |
| `INGESTION_MAX_ATTEMPTS_PER_RUN` | –ú–∞–∫—Å. –ø–æ–ø—ã—Ç–æ–∫ ingestion –∑–∞ –∑–∞–ø—É—Å–∫ | –ù–µ—Ç | `5` |

### –ü—É—Ç–∏ –∫ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é SQLite –±–∞–∑—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –≤ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:
- `ingestion_state.sqlite` ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- `raw_storage.sqlite` ‚Äî —Å—ã—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- `processing_storage.sqlite` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ —Ç–µ–º—ã

–ú–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —á–µ—Ä–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
```env
INGESTION_STATE_DB_PATH=./data/ingestion_state.sqlite
RAW_STORAGE_DB_PATH=./data/raw_storage.sqlite
PROCESSING_STORAGE_DB_PATH=./data/processing_storage.sqlite
```

---

## CLI –∫–æ–º–∞–Ω–¥—ã

–í—Å–µ –∫–æ–º–∞–Ω–¥—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è —á–µ—Ä–µ–∑:

```bash
python -m tg_parser.cli <–∫–æ–º–∞–Ω–¥–∞> [–æ–ø—Ü–∏–∏]
```

### –°–ø—Ä–∞–≤–∫–∞

```bash
# –û–±—â–∞—è —Å–ø—Ä–∞–≤–∫–∞
python -m tg_parser.cli --help

# –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–µ
python -m tg_parser.cli <–∫–æ–º–∞–Ω–¥–∞> --help
```

### `init` ‚Äî –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö

–°–æ–∑–¥–∞—ë—Ç SQLite –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ —Ç–∞–±–ª–∏—Ü—ã.

```bash
python -m tg_parser.cli init
```

**–û–ø—Ü–∏–∏:**
- `--force` ‚Äî –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –±–∞–∑—ã –¥–∞–∂–µ –µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç

**–ü—Ä–∏–º–µ—Ä:**
```bash
# –ü–µ—Ä–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
python -m tg_parser.cli init

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ (—É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ!)
python -m tg_parser.cli init --force
```

### `add-source` ‚Äî –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞

–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç Telegram –∫–∞–Ω–∞–ª –¥–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö.

```bash
python -m tg_parser.cli add-source --source-id <id> --channel-id <channel>
```

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏:**
- `--source-id` ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (–ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–∞—è —Å—Ç—Ä–æ–∫–∞)
- `--channel-id` ‚Äî ID –∫–∞–Ω–∞–ª–∞ –≤ Telegram (username –∏–ª–∏ numeric ID)

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏:**
- `--channel-username` ‚Äî username –∫–∞–Ω–∞–ª–∞ (–¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Å—ã–ª–æ–∫)
- `--include-comments` ‚Äî —Å–æ–±–∏—Ä–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –ø–æ—Å—Ç–∞–º
- `--batch-size` ‚Äî —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ (default: 100)

**–ü—Ä–∏–º–µ—Ä—ã:**
```bash
# –î–æ–±–∞–≤–∏—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π –∫–∞–Ω–∞–ª –ø–æ username
python -m tg_parser.cli add-source --source-id news --channel-id @durov

# –î–æ–±–∞–≤–∏—Ç—å —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
python -m tg_parser.cli add-source --source-id blog --channel-id @channel --include-comments

# –î–æ–±–∞–≤–∏—Ç—å –ø–æ numeric ID (–¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤)
python -m tg_parser.cli add-source --source-id private --channel-id -1001234567890
```

### `ingest` ‚Äî –°–±–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π

–°–æ–±–∏—Ä–∞–µ—Ç raw —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ Telegram –∫–∞–Ω–∞–ª–∞.

```bash
python -m tg_parser.cli ingest --source <source-id>
```

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏:**
- `--source` ‚Äî ID –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (–∏–∑ `add-source`)

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏:**
- `--mode` ‚Äî —Ä–µ–∂–∏–º —Å–±–æ—Ä–∞: `incremental` (default) –∏–ª–∏ `snapshot`
- `--limit` ‚Äî –ª–∏–º–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–π (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)

**–†–µ–∂–∏–º—ã:**
- `incremental` ‚Äî —Å–æ–±–∏—Ä–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞
- `snapshot` ‚Äî —Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

**–ü—Ä–∏–º–µ—Ä—ã:**
```bash
# –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–±–æ—Ä
python -m tg_parser.cli ingest --source news --mode incremental

# –ü–æ–ª–Ω—ã–π snapshot
python -m tg_parser.cli ingest --source news --mode snapshot

# –° –ª–∏–º–∏—Ç–æ–º –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
python -m tg_parser.cli ingest --source news --limit 10
```

> üì± **–ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫:** –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ Telethon –∑–∞–ø—Ä–æ—Å–∏—Ç –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏–∑ Telegram. –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ.

### `process` ‚Äî –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ LLM

–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç raw —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ LLM: –æ—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞, —Å–∞–º–º–∞—Ä–∏, –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–º –∏ —Å—É—â–Ω–æ—Å—Ç–µ–π.

**v1.2: Multi-LLM –ø–æ–¥–¥–µ—Ä–∂–∫–∞** ‚Äî OpenAI, Anthropic Claude, Google Gemini, Ollama.
**v2.0: Agent-based processing** ‚Äî –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º –Ω–∞ –±–∞–∑–µ OpenAI Agents SDK.
**v3.0: Multi-Agent Architecture** ‚Äî –º—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –∏ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∞–≥–µ–Ω—Ç–∞–º–∏.

```bash
python -m tg_parser.cli process --channel <channel-id> [OPTIONS]
```

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏:**
- `--channel` ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–∞–Ω–∞–ª–∞

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏:**
- `--provider` ‚Äî LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä: `openai`, `anthropic`, `gemini`, `ollama`
- `--model` ‚Äî –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–æ–¥–µ–ª—å
- `--concurrency` / `-c` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (default: 1)
- `--force` ‚Äî –ø–µ—Ä–µ–æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- `--retry-failed` ‚Äî –ø–æ–≤—Ç–æ—Ä–∏—Ç—å —Ç–æ–ª—å–∫–æ failed —Å–æ–æ–±—â–µ–Ω–∏—è
- `--agent` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å agent-based processing (v2.0)
- `--agent-llm` ‚Äî –≤–∫–ª—é—á–∏—Ç—å LLM-enhanced tools –¥–ª—è –∞–≥–µ–Ω—Ç–∞
- `--hybrid` ‚Äî –≤–∫–ª—é—á–∏—Ç—å v1.2 pipeline –∫–∞–∫ tool –∞–≥–µ–Ω—Ç–∞ (Phase 2E)
- `--multi-agent` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Multi-Agent Architecture (v3.0) ‚≠ê NEW
- `--dry-run` ‚Äî —Ä–µ–∂–∏–º –ø—Ä–æ–≤–µ—Ä–∫–∏

**–ü—Ä–∏–º–µ—Ä—ã:**
```bash
# –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å default –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º (v1.2 pipeline)
python -m tg_parser.cli process --channel @durov

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Anthropic Claude
python -m tg_parser.cli process --channel @durov --provider anthropic

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Gemini —Å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
python -m tg_parser.cli process --channel @durov --provider gemini -c 5

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π Ollama
python -m tg_parser.cli process --channel @durov --provider ollama --model qwen3:8b

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–æ–±—Ä–∞–±–æ—Ç–∫–∞
python -m tg_parser.cli process --channel @durov --force

# Multi-Agent Architecture (v3.0)
python -m tg_parser.cli process --channel @durov --multi-agent

# Multi-Agent —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º
python -m tg_parser.cli process --channel @durov --multi-agent --provider anthropic
```

#### Multi-Agent Architecture (v3.0) ‚≠ê NEW

–ù–æ–≤—ã–π —Ä–µ–∂–∏–º —Å –º—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π, –≥–¥–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–≥–µ–Ω—Ç—ã –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É—é—Ç—Å—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º:

```bash
# –ë–∞–∑–æ–≤—ã–π multi-agent —Ä–µ–∂–∏–º
python -m tg_parser.cli process --channel @durov --multi-agent

# –° –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º
python -m tg_parser.cli process --channel @durov --multi-agent --provider anthropic

# –° –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
python -m tg_parser.cli process --channel @durov --multi-agent -c 3
```

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Multi-Agent:**

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –†–æ–ª—å |
|-----------|------|
| **OrchestratorAgent** | –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è workflow, –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞—á |
| **ProcessingAgent** | –û—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞, –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–º/entities |
| **TopicizationAgent** | –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–æ —Ç–µ–º–∞–º |
| **ExportAgent** | –≠–∫—Å–ø–æ—Ä—Ç –≤ NDJSON/JSON —Ñ–æ—Ä–º–∞—Ç—ã |

> üí° **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Multi-Agent:**
> - –°–ª–æ–∂–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã —Ç—Ä–µ–±—É—é—â–∏–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
> - –†–∞—Å—à–∏—Ä—è–µ–º—ã–µ workflow —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤
> - –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

#### Agent-based Processing (v2.0)

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞ –±–∞–∑–µ OpenAI Agents SDK:

```bash
# Agent —Å –±–∞–∑–æ–≤—ã–º–∏ tools (–±—ã—Å—Ç—Ä–æ, –±–µ–∑ LLM –≤—ã–∑–æ–≤–æ–≤, ~0.3ms/—Å–æ–æ–±—â–µ–Ω–∏–µ)
python -m tg_parser.cli process --channel @durov --agent

# Agent —Å LLM-enhanced tools (–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ, —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑)
python -m tg_parser.cli process --channel @durov --agent --agent-llm

# Agent —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º
python -m tg_parser.cli process --channel @durov --agent --agent-llm --provider openai

# Hybrid mode ‚Äî agent + v1.2 pipeline (–∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞)
python -m tg_parser.cli process --channel @durov --agent --hybrid

# Full Hybrid ‚Äî LLM agent + pipeline tool (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ)
python -m tg_parser.cli process --channel @durov --agent --agent-llm --hybrid
```

**–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤:**

| –†–µ–∂–∏–º | –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ | –ö–∞—á–µ—Å—Ç–≤–æ | LLM –≤—ã–∑–æ–≤—ã | Tools |
|-------|-----------------|----------|------------|-------|
| **Pipeline v1.2** | 500-2000ms | –í—ã—Å–æ–∫–æ–µ | 1 | N/A |
| **Agent Basic** | ~0.3ms | –°—Ä–µ–¥–Ω–µ–µ | 1 | 3 |
| **Agent LLM** | 500-1500ms | –í—ã—Å–æ–∫–æ–µ | 2+ | 1 |
| **Hybrid Basic** | –ê–¥–∞–ø—Ç–∏–≤–Ω–æ | –í—ã—Å–æ–∫–æ–µ | 1-2 | 4 |
| **Hybrid LLM** | –ê–¥–∞–ø—Ç–∏–≤–Ω–æ | –õ—É—á—à–µ–µ | 2-3 | 2 |
| **Multi-Agent** ‚≠ê | –ê–¥–∞–ø—Ç–∏–≤–Ω–æ | –õ—É—á—à–µ–µ | N (—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–æ) | –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ |

> üí° **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Agent Basic:**
> - –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö
> - –†–∞–±–æ—Ç–∞ –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ (–æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º)
> - –°–Ω–∏–∂–µ–Ω–∏–µ –∑–∞—Ç—Ä–∞—Ç –Ω–∞ API

> üí° **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Agent LLM:**
> - –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
> - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ key_points –∏ sentiment

> üí° **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Hybrid Mode:**
> - –°–æ—á–µ—Ç–∞–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –∫–∞—á–µ—Å—Ç–≤–∞
> - Agent —Å–∞–º –≤—ã–±–∏—Ä–∞–µ—Ç: –ø—Ä–æ—Å—Ç—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è ‚Üí basic tools, —Å–ª–æ–∂–Ω—ã–µ ‚Üí pipeline
> - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å
> - –†–∞–±–æ—Ç–∞ —Å –≤–∞–∂–Ω—ã–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏

> ‚ö†Ô∏è **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ concurrency:**
> - **Cloud –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã** (OpenAI, Anthropic, Gemini): `-c 3` –¥–æ `-c 5`
> - **Ollama** (–ª–æ–∫–∞–ª—å–Ω—ã–π): `-c 1` (–ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è –∑–∞–º–µ–¥–ª—è–µ—Ç!)

### `topicize` ‚Äî –¢–µ–º–∞—Ç–∏–∑–∞—Ü–∏—è

–ö–ª–∞—Å—Ç–µ—Ä–∏–∑—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø–æ —Ç–µ–º–∞–º.

```bash
python -m tg_parser.cli topicize --channel <channel-id>
```

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏:**
- `--channel` ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–∞–Ω–∞–ª–∞

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏:**
- `--force` ‚Äî –ø–µ—Ä–µ—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–º—ã –¥–∞–∂–µ –µ—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å
- `--no-bundles` ‚Äî –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å topic bundles

**–ü—Ä–∏–º–µ—Ä—ã:**
```bash
# –°–æ–∑–¥–∞—Ç—å —Ç–µ–º—ã
python -m tg_parser.cli topicize --channel @durov

# –¢–æ–ª—å–∫–æ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ç–µ–º –±–µ–∑ bundles
python -m tg_parser.cli topicize --channel @durov --no-bundles

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø–µ—Ä–µ—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ
python -m tg_parser.cli topicize --channel @durov --force
```

### `export` ‚Äî –≠–∫—Å–ø–æ—Ä—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤

–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–∞–π–ª—ã –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º.

```bash
python -m tg_parser.cli export --out <directory>
```

**–û–ø—Ü–∏–∏:**
- `--out` ‚Äî –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –≤—ã–≤–æ–¥–∞ (default: `./output`)
- `--channel` ‚Äî —Ñ–∏–ª—å—Ç—Ä –ø–æ –∫–∞–Ω–∞–ª—É
- `--topic-id` ‚Äî —Ñ–∏–ª—å—Ç—Ä –ø–æ —Ç–µ–º–µ
- `--from-date` ‚Äî —Ñ–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ –æ—Ç (—Ñ–æ—Ä–º–∞—Ç: YYYY-MM-DD)
- `--to-date` ‚Äî —Ñ–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ –¥–æ (—Ñ–æ—Ä–º–∞—Ç: YYYY-MM-DD)
- `--pretty` ‚Äî —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON

**–í—ã—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `kb_entries.ndjson` ‚Äî –∑–∞–ø–∏—Å–∏ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π (NDJSON —Ñ–æ—Ä–º–∞—Ç)
- `topics.json` ‚Äî –∫–∞—Ç–∞–ª–æ–≥ –≤—Å–µ—Ö —Ç–µ–º
- `topic_<id>.json` ‚Äî –¥–µ—Ç–∞–ª—å–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç–µ–º

**–ü—Ä–∏–º–µ—Ä—ã:**
```bash
# –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
python -m tg_parser.cli export --out ./output

# –≠–∫—Å–ø–æ—Ä—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞
python -m tg_parser.cli export --channel @durov --out ./output

# –≠–∫—Å–ø–æ—Ä—Ç –∑–∞ –ø–µ—Ä–∏–æ–¥
python -m tg_parser.cli export --from-date 2025-01-01 --to-date 2025-12-31 --out ./output

# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON –¥–ª—è —á—Ç–µ–Ω–∏—è
python -m tg_parser.cli export --out ./output --pretty
```

### `run` ‚Äî One-shot Pipeline ‚≠ê

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –∫–æ–º–∞–Ω–¥–∞** ‚Äî –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–æ–ª–Ω—ã–π pipeline –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π:
1. `ingest` ‚Äî —Å–±–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π
2. `process` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ LLM
3. `topicize` ‚Äî —Ç–µ–º–∞—Ç–∏–∑–∞—Ü–∏—è
4. `export` ‚Äî —ç–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```bash
python -m tg_parser.cli run --source <source-id> --out <directory>
```

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏:**
- `--source` ‚Äî ID –∏—Å—Ç–æ—á–Ω–∏–∫–∞

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏:**
- `--out` ‚Äî –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –≤—ã–≤–æ–¥–∞ (default: `./output`)
- `--mode` ‚Äî —Ä–µ–∂–∏–º ingestion: `incremental` –∏–ª–∏ `snapshot`
- `--skip-ingest` ‚Äî –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —ç—Ç–∞–ø —Å–±–æ—Ä–∞
- `--skip-process` ‚Äî –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —ç—Ç–∞–ø –æ–±—Ä–∞–±–æ—Ç–∫–∏
- `--skip-topicize` ‚Äî –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —ç—Ç–∞–ø —Ç–µ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
- `--force` ‚Äî –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–æ–±—Ä–∞–±–æ—Ç–∫–∞
- `--limit` ‚Äî –ª–∏–º–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è ingestion

**–ü—Ä–∏–º–µ—Ä—ã:**
```bash
# –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫ (–ø–æ–ª–Ω—ã–π pipeline)
python -m tg_parser.cli run --source news --out ./output

# –†–µ–∂–∏–º snapshot (–≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è)
python -m tg_parser.cli run --source news --out ./output --mode snapshot

# –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å ingestion (–µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ —É–∂–µ —Å–æ–±—Ä–∞–Ω—ã)
python -m tg_parser.cli run --source news --out ./output --skip-ingest

# –¢–æ–ª—å–∫–æ —ç–∫—Å–ø–æ—Ä—Ç (–ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –∏ —Ç–µ–º–∞—Ç–∏–∑–∞—Ü–∏—é)
python -m tg_parser.cli run --source news --out ./output --skip-ingest --skip-process --skip-topicize

# –° –ª–∏–º–∏—Ç–æ–º –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
python -m tg_parser.cli run --source news --out ./output --limit 10

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ–≥–æ
python -m tg_parser.cli run --source news --out ./output --force
```

### `agents` ‚Äî –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–≥–µ–Ω—Ç–æ–≤ (v3.0) ‚≠ê NEW

–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–≥–µ–Ω—Ç–∞–º–∏ Multi-Agent —Å–∏—Å—Ç–µ–º—ã.

```bash
tg-parser agents <command>
```

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ–¥–∫–æ–º–∞–Ω–¥—ã:**

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `list` | –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ |
| `status` | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–≥–µ–Ω—Ç–∞ |
| `history` | –ò—Å—Ç–æ—Ä–∏—è –∑–∞–¥–∞—á –∞–≥–µ–Ω—Ç–∞ |
| `cleanup` | –û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç—ë–∫—à–∏—Ö –∑–∞–ø–∏—Å–µ–π |
| `handoffs` | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ handoff'–æ–≤ |
| `archives` | –°–ø–∏—Å–æ–∫ –∞—Ä—Ö–∏–≤–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ |

**–ü—Ä–∏–º–µ—Ä—ã:**

```bash
# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∞–≥–µ–Ω—Ç–æ–≤
tg-parser agents list

# –¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ –∞–≥–µ–Ω—Ç—ã —Ç–∏–ø–∞ processing
tg-parser agents list --type processing --active

# –°–ø–∏—Å–æ–∫ –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ
tg-parser agents list --format json

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–≥–µ–Ω—Ç–∞ –∑–∞ 30 –¥–Ω–µ–π
tg-parser agents status ProcessingAgent --days 30

# –ò—Å—Ç–æ—Ä–∏—è –∑–∞–¥–∞—á —Å –æ—à–∏–±–∫–∞–º–∏
tg-parser agents history ProcessingAgent --errors --limit 50

# –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ–≥–æ, —á—Ç–æ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–æ (dry run)
tg-parser agents cleanup --dry-run

# –û—á–∏—Å—Ç–∫–∞ —Å –∞—Ä—Ö–∏–≤–∞—Ü–∏–µ–π –≤ NDJSON.gz
tg-parser agents cleanup --archive

# –ê—Ä—Ö–∏–≤–∞—Ü–∏—è –≤–∫–ª—é—á–∞—è handoff'—ã
tg-parser agents cleanup --archive --include-handoffs

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ handoff'–æ–≤ –º–µ–∂–¥—É –∞–≥–µ–Ω—Ç–∞–º–∏
tg-parser agents handoffs --stats

# Handoff'—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
tg-parser agents handoffs --agent OrchestratorAgent

# –°–ø–∏—Å–æ–∫ –∞—Ä—Ö–∏–≤–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
tg-parser agents archives
```

**–§–æ—Ä–º–∞—Ç –∞—Ä—Ö–∏–≤–æ–≤:**
- `task_history_YYYYMMDD_HHMMSS.ndjson.gz` ‚Äî –∞—Ä—Ö–∏–≤ task_history
- `handoff_history_YYYYMMDD_HHMMSS.ndjson.gz` ‚Äî –∞—Ä—Ö–∏–≤ handoff_history

> üí° **–°–æ–≤–µ—Ç**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `--dry-run` –ø–µ—Ä–µ–¥ `cleanup` —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å, –∫–∞–∫–∏–µ –∑–∞–ø–∏—Å–∏ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### Quick Start ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä

```bash
# 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑—ã
python -m tg_parser.cli init

# 2. –î–æ–±–∞–≤–∏—Ç—å –∫–∞–Ω–∞–ª
python -m tg_parser.cli add-source --source-id test --channel-id @durov

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—ã–π pipeline
python -m tg_parser.cli run --source test --out ./output --limit 10
```

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `./output/`.

### –ü–æ–ª–Ω—ã–π pipeline –¥–ª—è –Ω–æ–≤–æ–≥–æ –∫–∞–Ω–∞–ª–∞

```bash
# 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑—ã (–æ–¥–∏–Ω —Ä–∞–∑)
python -m tg_parser.cli init

# 2. –î–æ–±–∞–≤–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫
python -m tg_parser.cli add-source \
    --source-id tech_news \
    --channel-id @techcrunchchannel \
    --include-comments

# 3. –°–æ–±—Ä–∞—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è (snapshot)
python -m tg_parser.cli ingest --source tech_news --mode snapshot

# 4. –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —á–µ—Ä–µ–∑ LLM
python -m tg_parser.cli process --channel @techcrunchchannel

# 5. –°–æ–∑–¥–∞—Ç—å —Ç–µ–º—ã
python -m tg_parser.cli topicize --channel @techcrunchchannel

# 6. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å
python -m tg_parser.cli export --channel @techcrunchchannel --out ./tech_news_output --pretty
```

### Incremental –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (—Ä–µ–≥—É–ª—è—Ä–Ω—ã–π —Å–±–æ—Ä)

```bash
# –°–æ–±—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å
python -m tg_parser.cli run --source tech_news --out ./tech_news_output --mode incremental
```

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ cron –¥–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

```bash
# –ö–∞–∂–¥—ã–π —á–∞—Å —Å–æ–±–∏—Ä–∞—Ç—å –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
0 * * * * cd /path/to/TG_parser && .venv/bin/python -m tg_parser.cli run --source tech_news --out ./output
```

### –≠–∫—Å–ø–æ—Ä—Ç —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏

```bash
# –≠–∫—Å–ø–æ—Ä—Ç –∑–∞ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥
python -m tg_parser.cli export \
    --from-date 2025-01-01 \
    --to-date 2025-06-30 \
    --out ./q1_q2_2025

# –≠–∫—Å–ø–æ—Ä—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ç–µ–º—ã
python -m tg_parser.cli export \
    --topic-id "topic:tg:channel:post:123" \
    --out ./single_topic

# –≠–∫—Å–ø–æ—Ä—Ç —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞ —Å pretty-print
python -m tg_parser.cli export \
    --channel @durov \
    --out ./durov_export \
    --pretty
```

### –†–∞–±–æ—Ç–∞ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∫–∞–Ω–∞–ª–∞–º–∏

```bash
# –î–æ–±–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
python -m tg_parser.cli add-source --source-id channel1 --channel-id @channel1
python -m tg_parser.cli add-source --source-id channel2 --channel-id @channel2
python -m tg_parser.cli add-source --source-id channel3 --channel-id @channel3

# –°–æ–±—Ä–∞—Ç—å –∏ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∂–¥—ã–π –æ—Ç–¥–µ–ª—å–Ω–æ
for source in channel1 channel2 channel3; do
    python -m tg_parser.cli run --source $source --out ./output
done

# –ò–ª–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å—ë –≤–º–µ—Å—Ç–µ
python -m tg_parser.cli export --out ./all_channels
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ Telegram

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ Telegram API –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö:

```bash
# –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
python scripts/add_test_messages.py

# –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
python -m tg_parser.cli process --channel test_channel

# –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
python scripts/view_processed.py --channel test_channel
```

---

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º—ã —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π Telegram

#### `FloodWaitError: You must wait X seconds`

Telegram –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç —á–∞—Å—Ç–æ—Ç—É –∑–∞–ø—Ä–æ—Å–æ–≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

**–†–µ—à–µ–Ω–∏–µ:** –ü–æ–¥–æ–∂–¥–∏—Ç–µ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è (X —Å–µ–∫—É–Ω–¥) –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–æ–ø—ã—Ç–∫—É.

#### `SessionPasswordNeededError`

–í–∞—à –∞–∫–∫–∞—É–Ω—Ç –∑–∞—â–∏—â—ë–Ω –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π.

**–†–µ—à–µ–Ω–∏–µ:** –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å 2FA –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ.

#### `PhoneCodeInvalidError`

–í–≤–µ–¥—ë–Ω –Ω–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.

**–†–µ—à–µ–Ω–∏–µ:** 
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–æ–¥ –≤–≤–µ–¥—ë–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–æ–¥ –Ω–µ –∏—Å—Ç—ë–∫ (–¥–µ–π—Å—Ç–≤—É–µ—Ç ~5 –º–∏–Ω—É—Ç)
3. –ó–∞–ø—Ä–æ—Å–∏—Ç–µ –Ω–æ–≤—ã–π –∫–æ–¥ –ø–æ–≤—Ç–æ—Ä–Ω—ã–º –∑–∞–ø—É—Å–∫–æ–º

#### `ApiIdInvalidError`

–ù–µ–≤–µ—Ä–Ω—ã–π API ID –∏–ª–∏ API Hash.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è `TELEGRAM_API_ID` –∏ `TELEGRAM_API_HASH` –≤ `.env`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–µ—Ç –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤
3. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ https://my.telegram.org –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

#### –§–∞–π–ª —Å–µ—Å—Å–∏–∏ –ø–æ–≤—Ä–µ–∂–¥—ë–Ω

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç —Å—Ç—Ä–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª —Å–µ—Å—Å–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –∑–∞–Ω–æ–≤–æ
rm tg_parser_session.session
python -m tg_parser.cli ingest --source <source>
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å OpenAI API

#### `AuthenticationError: Invalid API Key`

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `OPENAI_API_KEY` –≤ `.env`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–ª—é—á –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `sk-`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–ª—é—á –Ω–µ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –≤ OpenAI Dashboard

#### `RateLimitError`

–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ OpenAI API.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–∏–º–∏—Ç—ã –≤ OpenAI Dashboard
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `--limit` –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –æ–±—ä—ë–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏

#### `InsufficientQuotaError`

–ò—Å—á–µ—Ä–ø–∞–Ω –±–∞–ª–∞–Ω—Å OpenAI.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å –≤ OpenAI Dashboard
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ billing limits

### –ü—Ä–æ–±–ª–µ–º—ã —Å –¥–∞–Ω–Ω—ã–º–∏

#### –ü—É—Å—Ç–æ–π –≤—ã–≤–æ–¥ –ø—Ä–∏ export

**–ü—Ä–∏—á–∏–Ω—ã –∏ —Ä–µ—à–µ–Ω–∏—è:**
1. **–ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω ingest:** –ó–∞–ø—É—Å—Ç–∏—Ç–µ `ingest` –¥–ª—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
2. **–ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω process:** –ó–∞–ø—É—Å—Ç–∏—Ç–µ `process` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
3. **–ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω topicize:** –ó–∞–ø—É—Å—Ç–∏—Ç–µ `topicize` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ–º
4. **–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `--channel`, `--from-date`, `--to-date`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É `run` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤:
```bash
python -m tg_parser.cli run --source <source> --out ./output
```

#### `ChannelPrivateError` –∏–ª–∏ `ChannelInvalidError`

–ö–∞–Ω–∞–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –ø–æ–¥–ø–∏—Å–∞–Ω—ã –Ω–∞ –∫–∞–Ω–∞–ª (–¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–∏—è username
3. –î–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ numeric ID (`-100...`)

#### –û—à–∏–±–∫–∏ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

Processing –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∏—Ö –≤ `processing_failures`).

**–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ—à–∏–±–æ–∫:**
```bash
sqlite3 processing_storage.sqlite "SELECT source_ref, error_class, error_message FROM processing_failures;"
```

### –û–±—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

#### `ModuleNotFoundError: No module named 'tg_parser'`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
pip install -e .
```

#### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞

`sqlite3.OperationalError: database is locked`

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–µ –∑–∞–ø—É—â–µ–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ CLI
2. –ü–æ–¥–æ–∂–¥–∏—Ç–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–µ–¥—ã–¥—É—â–µ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
3. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∑–∞–≤–µ—Ä—à–∏—Ç–µ –∑–∞–≤–∏—Å—à–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã

#### –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–∞–º—è—Ç–∏ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –±–æ–ª—å—à–∏—Ö –∫–∞–Ω–∞–ª–æ–≤

**–†–µ—à–µ–Ω–∏–µ:**
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `--limit` –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –æ–±—ä—ë–º–∞
2. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø–æ—Ä—Ü–∏—è–º–∏
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ incremental —Ä–µ–∂–∏–º –≤–º–µ—Å—Ç–æ snapshot

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
# –í–∫–ª—é—á–∏—Ç—å debug –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
export LOG_LEVEL=DEBUG
python -m tg_parser.cli run --source test --out ./output
```

---

---

## Agent-based Processing (v2.0) ‚≠ê NEW

### –ß—Ç–æ —ç—Ç–æ?

**Agent-based processing** ‚Äî –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π [OpenAI Agents SDK](https://github.com/openai/openai-agents-python). –í–º–µ—Å—Ç–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ pipeline, –∞–≥–µ–Ω—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    TGProcessingAgent                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  –†–µ–∂–∏–º: Agent Basic (3 tools)                               ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ clean_text        ‚Üí Regex –æ—á–∏—Å—Ç–∫–∞                      ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ extract_topics    ‚Üí Keyword matching                   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ extract_entities  ‚Üí Pattern matching (email, URL, etc) ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  –†–µ–∂–∏–º: Agent LLM (1 tool)                                  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ analyze_text_deep ‚Üí LLM –¥–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞          ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ Semantic topics                                    ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ NER entities                                       ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ Key points extraction                              ‚îÇ
‚îÇ       ‚îî‚îÄ‚îÄ Sentiment analysis                                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  –†–µ–∂–∏–º: Hybrid Basic (4 tools) ‚≠ê Phase 2E                   ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ clean_text        ‚Üí Regex –æ—á–∏—Å—Ç–∫–∞                      ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ extract_topics    ‚Üí Keyword matching                   ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ extract_entities  ‚Üí Pattern matching                   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ process_with_pipeline ‚Üí v1.2 pipeline –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  –†–µ–∂–∏–º: Hybrid LLM (2 tools) ‚≠ê Phase 2E                     ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ analyze_text_deep     ‚Üí LLM –¥–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞      ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ process_with_pipeline ‚Üí v1.2 pipeline –∫–∞–∫ fallback     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ CLI

```bash
# Agent Basic ‚Äî –±—ã—Å—Ç—Ä–æ, –±–µ–∑ LLM (~0.3ms/—Å–æ–æ–±—â–µ–Ω–∏–µ)
python -m tg_parser.cli process --channel @durov --agent

# Agent LLM ‚Äî —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ —á–µ—Ä–µ–∑ LLM
python -m tg_parser.cli process --channel @durov --agent --agent-llm

# Hybrid Basic ‚Äî agent + pipeline tool (4 tools)
python -m tg_parser.cli process --channel @durov --agent --hybrid

# Hybrid LLM ‚Äî LLM agent + pipeline tool (2 tools, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ)
python -m tg_parser.cli process --channel @durov --agent --agent-llm --hybrid

# Agent LLM ‚Äî –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ, —Å LLM
python -m tg_parser.cli process --channel @durov --agent --agent-llm

# –° –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
python -m tg_parser.cli process --channel @durov --agent -c 5
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ Python

```python
from tg_parser.agents import TGProcessingAgent
from tg_parser.domain.models import RawTelegramMessage

# Agent Basic (–±–µ–∑ LLM)
agent = TGProcessingAgent(
    model="gpt-4o-mini",
    use_llm_tools=False,  # –¢–æ–ª—å–∫–æ pattern matching
)

doc = await agent.process(message)
print(doc.topics)    # ['laboratory', 'medicine']
print(doc.entities)  # [Entity(type='email', value='test@lab.com')]

# Agent LLM (—Å –≥–ª—É–±–æ–∫–∏–º –∞–Ω–∞–ª–∏–∑–æ–º)
from tg_parser.processing.llm.factory import create_llm_client

llm_client = create_llm_client(
    provider="openai",
    api_key="sk-...",
)

agent_llm = TGProcessingAgent(
    model="gpt-4o-mini",
    provider="openai",
    use_llm_tools=True,
    llm_client=llm_client,
)

doc = await agent_llm.process(message)
print(doc.topics)                     # ['–∫–ª–∏–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏', '–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞']
print(doc.metadata.get('key_points')) # ['–í–∞–∂–Ω–æ—Å—Ç—å –ø—Ä–µ–∞–Ω–∞–ª–∏—Ç–∏–∫–∏', ...]
print(doc.metadata.get('sentiment'))  # 'neutral'
```

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞

–°–∫—Ä–∏–ø—Ç –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è Agent vs Pipeline:

```bash
# –ë–∞–∑–æ–≤–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –Ω–∞ 10 —Å–æ–æ–±—â–µ–Ω–∏—è—Ö
python scripts/compare_agents_pipeline.py --limit 10

# –° LLM –∞–≥–µ–Ω—Ç–æ–º (—Ç—Ä–µ–±—É–µ—Ç OPENAI_API_KEY)
python scripts/compare_agents_pipeline.py --limit 5 --llm
```

### –ö–æ–≥–¥–∞ —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?

| –°—Ü–µ–Ω–∞—Ä–∏–π | –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–µ–∂–∏–º |
|----------|---------------------|
| –ë—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –º–∏–ª–ª–∏–æ–Ω–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π | `--agent` |
| –û—Ñ–ª–∞–π–Ω —Ä–∞–±–æ—Ç–∞ –±–µ–∑ API | `--agent` |
| –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ | `--agent --agent-llm` |
| Production —Å –±–∞–ª–∞–Ω—Å–æ–º —Å–∫–æ—Ä–æ—Å—Ç—å/–∫–∞—á–µ—Å—Ç–≤–æ | Pipeline v1.2 |
| –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ entities | Pipeline v1.2 + Anthropic |
| –°–ª–æ–∂–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã, —Ä–∞—Å—à–∏—Ä—è–µ–º—ã–µ workflow | `--multi-agent` ‚≠ê NEW |
| –ö–∞—Å—Ç–æ–º–Ω—ã–µ pipeline —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º | `--multi-agent` ‚≠ê NEW |

---

## Multi-Agent Architecture (v3.0) ‚≠ê NEW

### –ß—Ç–æ —ç—Ç–æ?

**Multi-Agent Architecture** ‚Äî –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —ç—Ç–∞–ø–æ–≤ pipeline. –í–º–µ—Å—Ç–æ –µ–¥–∏–Ω–æ–≥–æ –º–æ–Ω–æ–ª–∏—Ç–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞, —Å–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –∏ –Ω–∞–±–æ—Ä —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤.

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     OrchestratorAgent                           ‚îÇ
‚îÇ   ‚Ä¢ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è workflow                                        ‚îÇ
‚îÇ   ‚Ä¢ –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞—á –º–µ–∂–¥—É –∞–≥–µ–Ω—Ç–∞–º–∏                         ‚îÇ
‚îÇ   ‚Ä¢ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –æ–±—Ä–∞–±–æ—Ç–∫–∏                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                    ‚îÇ                    ‚îÇ
         ‚ñº                    ‚ñº                    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ProcessingAgent ‚îÇ  ‚îÇTopicizationAgent‚îÇ  ‚îÇ   ExportAgent   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚Ä¢ clean_text    ‚îÇ  ‚îÇ ‚Ä¢ cluster_docs  ‚îÇ  ‚îÇ ‚Ä¢ export_ndjson ‚îÇ
‚îÇ ‚Ä¢ extract_topics‚îÇ  ‚îÇ ‚Ä¢ create_topic  ‚îÇ  ‚îÇ ‚Ä¢ export_json   ‚îÇ
‚îÇ ‚Ä¢ extract_entities‚îÇ ‚îÇ   cards        ‚îÇ  ‚îÇ ‚Ä¢ format_output ‚îÇ
‚îÇ ‚Ä¢ simple/deep   ‚îÇ  ‚îÇ ‚Ä¢ update_topics ‚îÇ  ‚îÇ                 ‚îÇ
‚îÇ   mode routing  ‚îÇ  ‚îÇ                 ‚îÇ  ‚îÇ                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å | –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ |
|-----------|-----------------|-------------|
| **OrchestratorAgent** | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ workflow | –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ |
| **ProcessingAgent** | –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ | –û—á–∏—Å—Ç–∫–∞, topics, entities, routing (simple/deep) |
| **TopicizationAgent** | –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è | Topic cards, bundles, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–º |
| **ExportAgent** | –≠–∫—Å–ø–æ—Ä—Ç | NDJSON, JSON, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ |

### Handoff Protocol

–ê–≥–µ–Ω—Ç—ã –æ–±–º–µ–Ω–∏–≤–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–º–∏ —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª:

```python
# –ó–∞–ø—Ä–æ—Å –Ω–∞ –ø–µ—Ä–µ–¥–∞—á—É –∑–∞–¥–∞—á–∏
HandoffRequest(
    source_agent="ProcessingAgent",
    target_agent="TopicizationAgent", 
    task="cluster_documents",
    payload={"documents": [...]},
    priority="normal"
)

# –û—Ç–≤–µ—Ç
HandoffResponse(
    request_id="...",
    status="completed",
    output={"topics": [...]},
    processing_time=1.5
)
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ CLI

```bash
# –ë–∞–∑–æ–≤—ã–π multi-agent —Ä–µ–∂–∏–º
python -m tg_parser.cli process --channel @durov --multi-agent

# –° –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º  
python -m tg_parser.cli process --channel @durov --multi-agent --provider anthropic

# –° –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
python -m tg_parser.cli process --channel @durov --multi-agent -c 3
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ Python

```python
from tg_parser.agents import (
    AgentRegistry,
    OrchestratorAgent,
    ProcessingAgent,
    TopicizationAgent,
    ExportAgent,
    AgentInput,
)

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è registry
registry = AgentRegistry()

# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–æ–≤
processing = ProcessingAgent(llm_client=llm_client)
topicization = TopicizationAgent(llm_client=llm_client)
export = ExportAgent(llm_client=llm_client)

registry.register(processing)
registry.register(topicization)
registry.register(export)

# –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
orchestrator = OrchestratorAgent(registry=registry, llm_client=llm_client)
await orchestrator.initialize()

# –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ workflow
result = await orchestrator.execute_workflow("full_pipeline", documents)

await orchestrator.shutdown()
```

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?

| –°—Ü–µ–Ω–∞—Ä–∏–π | –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–µ–∂–∏–º |
|----------|---------------------|
| –ü—Ä–æ—Å—Ç–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ | Pipeline v1.2 –∏–ª–∏ Agent Basic |
| –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ | Agent LLM –∏–ª–∏ Hybrid |
| –°–ª–æ–∂–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã, —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å | **Multi-Agent (v3.0)** |
| –ö–∞—Å—Ç–æ–º–Ω—ã–µ workflow | **Multi-Agent (v3.0)** |
| –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ –∞–≥–µ–Ω—Ç–∞–º | **Multi-Agent (v3.0)** |

### Agent Registry

–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä –∞–≥–µ–Ω—Ç–æ–≤ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏:

- **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–æ—Ç–º–µ–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏** –∞–≥–µ–Ω—Ç–æ–≤
- **–ü–æ–∏—Å–∫ –ø–æ —Ç–∏–ø—É –∏ capabilities**
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á
- **Health checks** –¥–ª—è –≤—Å–µ—Ö –∞–≥–µ–Ω—Ç–æ–≤

```python
# –ü–æ–ª—É—á–∏—Ç—å –∞–≥–µ–Ω—Ç–∞ –ø–æ —Ç–∏–ø—É
agent = registry.get_by_type(AgentType.PROCESSING)

# –ù–∞–π—Ç–∏ –∞–≥–µ–Ω—Ç–∞ –ø–æ capability
agent = registry.find_best_for_capability(AgentCapability.ENTITY_EXTRACTION)

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
stats = registry.get_statistics()
print(stats)  # {'ProcessingAgent': {'tasks_completed': 100, 'success_rate': 0.98}}
```

---

## Agent State Persistence (v3.0.0-alpha.2) ‚≠ê NEW

### –ß—Ç–æ —ç—Ç–æ?

**Agent State Persistence** ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞–≥–µ–Ω—Ç–æ–≤ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –¥–ª—è:
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞
- –ü–æ–ª–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è input/output –∑–∞–¥–∞—á
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∞–≥–µ–Ω—Ç–æ–≤
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ handoffs

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:

```env
# Agent State Persistence (Phase 3B)
AGENT_RETENTION_DAYS=14           # –°–∫–æ–ª—å–∫–æ –¥–Ω–µ–π —Ö—Ä–∞–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∑–∞–¥–∞—á
AGENT_RETENTION_MODE=delete       # –ß—Ç–æ –¥–µ–ª–∞—Ç—å —Å –∏—Å—Ç—ë–∫—à–∏–º–∏: delete | export
AGENT_STATS_ENABLED=true          # –í–∫–ª—é—á–∏—Ç—å –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
AGENT_PERSISTENCE_ENABLED=true    # –í–∫–ª—é—á–∏—Ç—å persistence
```

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|----------|
| **AgentStateRepo** | –•—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∞–≥–µ–Ω—Ç–æ–≤ |
| **TaskHistoryRepo** | –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –∑–∞–¥–∞—á —Å input/output –∏ TTL |
| **AgentStatsRepo** | –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ |
| **HandoffHistoryRepo** | –ò—Å—Ç–æ—Ä–∏—è handoffs –º–µ–∂–¥—É –∞–≥–µ–Ω—Ç–∞–º–∏ |

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ Python

```python
from tg_parser.agents import AgentPersistence, AgentRegistry
from tg_parser.storage.sqlite import (
    SQLiteAgentStateRepo,
    SQLiteTaskHistoryRepo,
    SQLiteAgentStatsRepo,
    SQLiteHandoffHistoryRepo,
)

# –°–æ–∑–¥–∞—Ç—å persistence layer
persistence = AgentPersistence(
    agent_state_repo=SQLiteAgentStateRepo(session_factory),
    task_history_repo=SQLiteTaskHistoryRepo(session_factory, default_retention_days=14),
    agent_stats_repo=SQLiteAgentStatsRepo(session_factory),
    handoff_history_repo=SQLiteHandoffHistoryRepo(session_factory),
)

# Registry —Å persistence
registry = AgentRegistry(persistence=persistence)

# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
await registry.register_with_persistence(agent)

# –ó–∞–ø–∏—Å—å –∑–∞–¥–∞—á–∏ —Å –ø–æ–ª–Ω—ã–º input/output
task_id = await registry.record_task_completion_with_persistence(
    name="ProcessingAgent",
    task_type="process_message",
    input_data={"text": "...", "source_ref": "tg_test_1"},
    output_data={"summary": "...", "topics": ["..."]},
    processing_time_ms=150,
    success=True,
)

# –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∞–≥–µ–Ω—Ç–∞ –∑–∞ 30 –¥–Ω–µ–π
summary = await persistence.get_agent_summary("ProcessingAgent", days=30)
print(f"Total tasks: {summary['total_tasks']}")
print(f"Success rate: {summary['success_rate']:.1%}")
print(f"Avg time: {summary['avg_processing_time_ms']:.0f}ms")

# –û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç—ë–∫—à–∏—Ö –∑–∞–ø–∏—Å–µ–π
deleted = await persistence.cleanup_expired_tasks()
print(f"Cleaned up {deleted} expired records")
```

### –¢–∞–±–ª–∏—Ü—ã –≤ processing_storage.sqlite

| –¢–∞–±–ª–∏—Ü–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---------|------------|
| `agent_states` | –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∞–≥–µ–Ω—Ç–æ–≤, capabilities, –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ |
| `task_history` | –ü–æ–ª–Ω—ã–π input/output –∑–∞–¥–∞—á —Å expires_at –¥–ª—è TTL |
| `agent_stats` | –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã: total_tasks, successful, failed, avg_time |
| `handoff_history` | –ò—Å—Ç–æ—Ä–∏—è handoffs: source ‚Üí target, status, processing_time |

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- [Architecture](architecture.md) ‚Äî –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã
- [Pipeline](pipeline.md) ‚Äî –¥–µ—Ç–∞–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- [Data Flow](DATA_FLOW.md) ‚Äî –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö
- [LLM Prompts](LLM_PROMPTS.md) ‚Äî –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è LLM
- [Technical Requirements](technical-requirements.md) ‚Äî —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- [Data Contracts](contracts/) ‚Äî JSON Schema –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã


# TG_parser – Архитектура

## Цель

TG_parser предназначен для:
- сбора сообщений из Telegram‑каналов;
- обработки и структурирования информации с помощью ИИ;
- пополнения тематической базы знаний.

## Высокоуровневый обзор

Основные подсистемы (MVP‑срез):
- **Ingestion (Telegram)** – получение сырых сообщений из каналов;
- **Processing (LLM)** – очистка текста, нормализация, извлечение структуры и смысловых сущностей;
- **Storage** – сохранение raw/processed артефактов (SQLite → PostgreSQL по мере роста);
- **Access / Export** – в MVP: **CLI‑экспорт** (без HTTP API), далее возможно API/сервисы.

Поток данных (упрощённо, MVP):
Telegram Channel → `RawTelegramMessage` → `ProcessedDocument` (+ `TopicCard`/`TopicBundle`) → **CLI‑экспорт** → `KnowledgeBaseEntry`.

## Модули

### Ingestion (Telegram)
- Интеграция с Telegram API/клиентом.
- Планирование и повторный запуск задач сбора.
- Дедупликация и идемпотентность.
- Выходные данные: объекты `RawTelegramMessage` (см. `docs/contracts/raw_telegram_message.schema.json`).

### Processing / LLM
- Препроцессинг сообщений (очистка, нормализация, разбиение).
- Запросы к LLM/классификаторам (MVP: **облачный LLM**, провайдер выбирается пользователем через конфигурацию; см. `docs/tech-stack.md`).
- Формирование структурированных `ProcessedDocument`.

### Storage
- В MVP хранит raw/processed артефакты (SQLite → PostgreSQL по мере роста).
- `KnowledgeBaseEntry` в MVP формируется на этапе **экспорта** (CLI), а не обязательно хранится как отдельная таблица/сущность.
- При добавлении поиска/серверного режима возможны индексы (например, полнотекстовый/векторный).

### Access / Export
- В MVP интерфейс доступа — CLI‑экспорт (без HTTP API) (см. TR‑55..TR‑64).

### Observability и управление
- Логирование ключевых шагов пайплайна.
- Метрики (объём, задержка, ошибки).
- Конфигурация моделей, лимитов Telegram, параметров шедулера.

## Нефункциональные требования (сводка)

- Источник истины по NFR и наблюдаемости — `docs/technical-requirements.md` (раздел TR‑NF‑* и TR‑OBS‑*). Ниже — краткая сводка:
  - Масштабируемость по числу каналов и объёму истории.
  - Минимизация потерь сообщений (надёжная обработка ошибок и ретраи).
  - Прозрачность работы: логи, метрики, возможность аудита источников.
  - Чёткие интерфейсы между модулями (контракты в `docs/contracts/`).

## Связанные документы

- ADR: `docs/adr/0001-overall-architecture.md`, `docs/adr/0002-telegram-ingestion-approach.md`, `docs/adr/0003-storage-and-indexing.md`
- Стек технологий: `docs/tech-stack.md`
- Технические требования: `docs/technical-requirements.md`



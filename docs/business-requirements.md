# Бизнес‑требования TG_parser

## 1. Стейкхолдеры и пользователи

- **Аналитик/исследователь**: ищет информацию по теме, собирает доказательства, делает выводы.
- **Куратор базы знаний**: отвечает за качество, структуру, актуальность и управляемость данных.
- **Разработчик интеграций**: использует базу знаний как источник для ассистентов/ботов/сервисов и ИИ‑агентов.
- **Заказчик/владелец источников**: предоставляет список каналов и ожидаемые результаты (тематика/глубина/актуальность).

## 1.1 Глоссарий (бизнес‑уровень)

- **Материал**: единица исходного контента из Telegram, включающая **пост** и/или **комментарий**.
- **Элемент**: единица, учитываемая в метриках покрытия/структурирования. По умолчанию **элемент = материал**, если в конкретном проекте/итерации не введена иная единица (например, “тред” или агрегированный документ).
- **Тематическая подборка**: связанный набор материалов (посты + релевантные комментарии) по теме со ссылками на первоисточники.
- **Карточка темы**: человекочитаемое описание темы (название, краткое описание, границы) + ссылки на первоисточники; тема может быть **темой‑статьёй** или **темой‑кластером**.
- **Тема‑статья (singleton)**: тема, основанная на одном якорном материале, который раскрывает вопрос/объект.
- **Тема‑кластер**: тема, объединяющая несколько материалов вокруг одного сюжета.
- **Целевые темы**: темы, заданные заказчиком/пользователем заранее для извлечения информации.
- **«В базе знаний» (MVP‑трактовка)**: результат считается “попавшим в базу знаний”, когда он доступен потребителю через CLI‑экспорт (например `kb_entries.ndjson`, `topics.json`, `topic_<topic_id>.json`). При появлении API/сервиса трактовка расширяется на эти интерфейсы.

## 2. Бизнес‑цели (BR)

 - **BR‑1 Автоматизация сбора**: исключить необходимость ручного сбора контента из Telegram‑каналов (свести ручные действия к настройке и контролю процесса).
- **BR‑2 Превращение в базу знаний**: преобразовать разрозненные сообщения/комментарии в структурированные и упорядоченные данные.
- **BR‑3 Актуальность**: обеспечивать регулярное обновление базы знаний по мере появления новых сообщений.
- **BR‑4 Доступность для поиска и аналитики**: сделать возможным быстрый поиск/фильтрацию/анализ для людей и программных потребителей (в т. ч. ИИ‑агентов).
- **BR‑5 Масштабирование источников**: поддерживать подключение множества каналов и, в перспективе, расширение на другие источники.
- **BR‑6 Тематическая навигация вместо ленты**: обеспечить группировку контента канала по обсуждаемым темам так, чтобы пользователь мог получать «всё по теме» без прокрутки ленты, включая релевантные комментарии.

## 3. Основные пользовательские сценарии (Use Cases)

- **UC‑1 Подключение источников**: добавить/удалить Telegram‑каналы, задать параметры сбора.
- **UC‑2 Историческая загрузка**: собрать историю канала за выбранный период.
- **UC‑3 Поддержание актуальности**: регулярно подтягивать новые сообщения и комментарии.
- **UC‑4 Обработка и структурирование**: преобразовать контент в «единицы знания» (документы) с нужными атрибутами для поиска/аналитики.
- **UC‑4a Тематическая группировка (известные целевые темы)**: собрать тематическую подборку по заранее заданной теме (или списку тем) и включить в неё связанные посты и комментарии, опубликованные в разные моменты времени.
- **UC‑4b Тематическая навигация (темы заранее неизвестны)**: обнаружить темы, присутствующие в канале, и предоставить возможность получать «всё по выбранной теме» по всему каналу.
- **UC‑5 Доступ потребителей**: предоставить результаты внешним потребителям (аналитикам, ИИ‑агентам, интеграциям) в согласованном виде.
- **UC‑6 База знаний по источникам заказчика**: сформировать базу знаний по заранее заданному набору каналов под задачу заказчика.

## 3.1 Определение «темы» (бизнес‑уровень)

**Тема** — это смысловой сюжет/вопрос в рамках области канала, по которому можно сформировать **тематическую подборку** (посты и релевантные комментарии) с ссылками на первоисточники, даже если материалы опубликованы в разное время.

TG_parser должен поддерживать оба случая:
- **Известные целевые темы** (заданы заказчиком/пользователем заранее): система собирает и обновляет подборки «всё по теме X».
- **Темы заранее неизвестны**: система обнаруживает темы канала и позволяет получать подборки «всё по теме» по всему каналу.

### 3.1.1 Когда тема считается выявленной/сформированной

Чтобы не превращать каждое разовое упоминание в «тему», TG_parser использует критерии сформированности темы на бизнес‑уровне. При этом **количество постов не является обязательным критерием**: одна публикация может быть полноценной темой (например, подробный разбор одного анализа в канале по лабораторной диагностике).

Тема считается **сформированной**, если выполняются все условия:
- **Человекочитаемая формулировка**: есть название темы и краткое описание (1–3 предложения).
- **Формат формулировки**: название темы должно быть выражено как **вопрос** (например, «Как интерпретировать анализ X?») или как **объект/аспект** (например, «Анализ X: подготовка, показания, интерпретация»).
- **Границы темы**: можно указать, что относится к теме и что не относится (минимально — 1–3 пункта “in/out of scope”).
- **Якорь(я) первоисточника**: у темы есть как минимум один первоисточник (пост и/или ключевой комментарий) со ссылкой/идентификатором.
- **Отличимость от других тем**: тема не является дубликатом/синонимом уже существующей темы; при близости должна оформляться как под‑тема/вариант/синоним, а не как новая независимая тема.

Допускаются два корректных способа сформированности:
- **Тема‑статья (singleton)**: тема опирается на один “сильный” якорный материал, который самодостаточно раскрывает вопрос.
- **Тема‑кластер**: тема объединяет несколько материалов (посты/комментарии) вокруг одного сюжета.

### 3.1.2 Рекомендуемый предварительный набор полей карточки темы (MVP)

Ниже — **рекомендованный предварительный** набор полей карточки темы для MVP. Окончательное решение по полям будет принято позже в процессе разработки.

Обязательные поля:
- **Название (`title`)**: в формате вопроса или объекта/аспекта.
- **Краткое описание (`summary`)**: 1–3 предложения “про что тема”.
- **Границы темы — что входит (`scope_in`)**: 1–5 пунктов.
- **Границы темы — что не входит (`scope_out`)**: 1–5 пунктов.
- **Тип темы (`type`)**: `singleton` или `cluster`.
- **Якорные первоисточники (`anchors`)**: список ссылок/идентификаторов на пост(ы) и/или ключевые комментарии (минимум 1).
- **Источники (`sources`)**: список каналов, к которым относится тема.
- **Дата обновления (`updated_at`)**: момент последнего обновления темы/подборки.

Рекомендуемые (можно отложить в MVP при необходимости):
- **Теги/ключевые слова (`tags`)**: 3–10 терминов для поиска и фильтрации.
- **Связанные темы (`related_topics`)**: ссылки на близкие/родительские/дочерние темы.
- **Статус (`status`)**: например `active` / `inactive` / `needs_review`.

## 4. Функциональные требования (FR)

### 4.1 Управление источниками

- **FR‑1**: Система должна поддерживать список подключённых Telegram‑каналов как управляемый набор источников.
- **FR‑2**: Для источника должны поддерживаться параметры сбора (например: период истории, частота обновления, правила включения/исключения).
- **FR‑3**: Система должна фиксировать статус источника (активен/приостановлен/ошибка) и историю попыток обновления.

### 4.2 Сбор данных из Telegram

- **FR‑4**: Система должна собирать сообщения из каналов (исторически и инкрементально).
- **FR‑5**: Система должна собирать связанные комментарии/обсуждения, если они доступны и важны для полноты информации.
- **FR‑6**: Система должна сохранять исходные данные в неизменном виде (raw), чтобы обеспечивать трассируемость и возможность переобработки.
- **FR‑6a (без дублей)**: повторный сбор/переобработка не должны приводить к неконтролируемому появлению дубликатов материалов и результатов в базе знаний.

### 4.3 Обработка и структурирование (с участием ИИ)

- **FR‑7**: Система должна преобразовывать исходные сообщения/комментарии в структурированные документы базы знаний.
- **FR‑8**: Для каждого структурированного документа должна сохраняться привязка к источнику (канал, дата/время, ссылка/идентификатор), чтобы пользователь мог перейти к первоисточнику.
- **FR‑9**: Система должна обеспечивать упорядочивание/классификацию информации по тематике (например: темы/теги/категории) в объёме, достаточном для поиска и аналитики.
- **FR‑9a**: Система должна обеспечивать **группировку по темам**: формировать тематические группы/подборки, объединяющие материалы, относящиеся к одной теме, даже если исходные посты разнесены во времени.
- **FR‑9b**: Тематическая группа должна включать релевантные **комментарии**, если они содержат важные уточнения по теме, и сохранять ссылки на первоисточники (пост/комментарий).
- **FR‑9c (режим “известные темы”)**: система должна поддерживать список целевых тем, заданных пользователем/заказчиком, и формировать по каждой теме обновляемую тематическую подборку.
- **FR‑9d (режим “темы неизвестны”)**: система должна формировать перечень тем, выявленных в канале, и обеспечивать возможность получения тематической подборки по любой из выявленных тем.
- **FR‑9e (карточка темы)**: для каждой темы система должна формировать человекочитаемую карточку темы, содержащую как минимум: название, краткое описание, границы (in/out of scope), тип темы (тема‑статья / тема‑кластер) и ссылки на первоисточники (посты и релевантные комментарии).
- **FR‑9f (якорный первоисточник)**: каждая тема должна иметь как минимум один якорный первоисточник (пост или ключевой комментарий), который является основанием существования темы и доступен по ссылке/идентификатору.
- **FR‑10**: Система должна снижать информационный шум (например, помечать/фильтровать рекламные или нерелевантные сообщения) на уровне, достаточном для практического использования базы знаний.

### 4.4 Доступ к базе знаний для потребителей

- **FR‑11**: Система должна предоставлять доступ к структурированным данным для внешних потребителей (аналитики/сервисы/ИИ‑агенты) в согласованном формате.
- **FR‑12**: Должна поддерживаться возможность поиска и фильтрации по базовым атрибутам (источник/дата/тема и т. п.) — как минимум на уровне интерфейса доступа к данным.
- **FR‑13**: Должна поддерживаться выгрузка/экспорт набора знаний по заданным критериям (например, по каналу/периоду/теме) для дальнейшего анализа.

## 5. Нефункциональные бизнес‑требования (NFR)

- **NFR‑1 Актуальность**: обновления должны происходить регулярно; целевые значения частоты/задержки задаются в рамках конкретного проекта/заказчика.
- **NFR‑2 Масштабируемость**: решение должно поддерживать рост числа каналов и объёма сообщений без деградации до неприемлемого уровня для пользователей.
- **NFR‑3 Трассируемость**: у каждого элемента базы знаний должна быть ссылка/идентификатор первоисточника и возможность объяснить происхождение данных.
- **NFR‑4 Качество данных**: допускается несовершенство извлечения, но качество должно быть управляемым: измеряемым и улучшаемым итерациями.
- **NFR‑5 Надёжность**: сбои отдельных источников не должны ломать обработку остальных; ошибки должны быть обнаруживаемы и устранимы.
- **NFR‑6 Доступ и разграничение прав**: доступ к результатам (экспорт/интерфейс доступа к данным) должен поддерживать разграничение прав в соответствии с контекстом использования (например, “по проекту/заказчику/набору источников”).
- **NFR‑7 Правовые и этические ограничения**: использование данных должно соответствовать применимым правилам и ограничениям (например, условиям доступа к источникам, требованиям к обработке персональных данных и контента).

## 6. Ограничения и допущения

- Источники на старте — **Telegram‑каналы**; подключение других источников рассматривается как дальнейшее расширение.
- Предполагается, что сбор и использование контента производится в рамках прав/доступов, которыми располагает заказчик/пользователь (например, для публичных источников или при наличии разрешений на доступ).
- Параметры объёма/частоты сбора зависят от ограничений внешних платформ и должны конфигурироваться.
- Обработка «богатых» форматов (видео/аудио) может быть поддержана не сразу; продукт должен уметь эволюционировать в эту сторону.
- В рамках бизнес‑требований не фиксируется конкретный пользовательский интерфейс: достаточно обеспечить доступ к результатам через программный интерфейс/экспорт для аналитиков, интеграций и ИИ‑агентов.

## 7. Критерии приемки (Acceptance Criteria) по ключевым сценариям

- **AC‑1 (UC‑1)**: можно задать список каналов и включить сбор; система фиксирует статус и прогресс по каждому источнику.
- **AC‑2 (UC‑2)**: при заданном периоде истории система формирует полный набор raw‑данных за период и помечает завершение загрузки.
- **AC‑2a (FR‑6a)**: повторный запуск сбора/переобработки на одном и том же периоде не приводит к росту дубликатов в результатах (суммарные объёмы стабилизируются с учётом появления новых данных).
- **AC‑3 (UC‑3)**: новые сообщения/комментарии появляются в базе знаний с задержкой, приемлемой для пользователя/заказчика (целевое значение задаётся в проекте).
- **AC‑4 (UC‑4)**: в базе знаний появляются структурированные документы с базовыми атрибутами (источник, время, тема/категория, ссылка на первоисточник).
- **AC‑4a (UC‑4a)**: по заранее заданной теме формируется тематическая подборка, которая включает материалы из разных дат/периодов и содержит ссылки на первоисточники, включая релевантные комментарии.
- **AC‑4b (UC‑4b)**: по каналу доступен перечень выявленных тем; для выбранной темы формируется тематическая подборка по всему каналу со ссылками на первоисточники.
- **AC‑4c (карточка темы)**: для любой темы доступна карточка темы, в которой присутствуют обязательные поля: название, краткое описание, границы (in/out of scope), тип темы (тема‑статья / тема‑кластер) и как минимум один якорный первоисточник со ссылкой/идентификатором.
- **AC‑4d (singleton‑темы)**: система допускает темы‑статьи: тема может быть сформирована на основе одного якорного материала, если карточка темы заполнена (название/описание/границы), указан тип «тема‑статья», а якорный первоисточник доступен по ссылке/идентификатору.
- **AC‑5 (UC‑5)**: внешний потребитель может получить и отфильтровать данные по источнику/периоду/теме и выгрузить результат.

## 8. Метрики успеха

- **Time‑to‑Knowledge**: медианное/95‑перцентильное время доставки в базу знаний.
- **Покрытие**: число подключённых каналов, объём обработанных сообщений/комментариев.
- **Полнота структурирования**: доля обработанных элементов, у которых заполнены обязательные атрибуты (источник/время/ссылка на первоисточник) и добавлены признаки для поиска (например, тема/теги).
- **Покрытие тем**: доля контента, попавшего в темы, с разрезом:
  - **в тема‑статьи (singleton)**,
  - **в тема‑кластеры**,
  - **вне тем** (не включено ни в одну тему).
- **Покрытие целевых тем (режим “известные темы”)**: доля целевых тем, для которых сформирована тематическая подборка (и доля тем без найденного контента).
- **Стабильность каталога тем (режим “темы неизвестны”)**: изменение состава тем во времени (например, доля тем, которые были переименованы/слиты/разделены за период), чтобы каталог оставался пригодным для навигации.
- **Снижение шума**: доля элементов, помеченных как реклама/нерелевантное, и изменение качества выдачи при включённой фильтрации (через оценку пользователей/экспертов).
- **Полезность**: качество выдачи на типовых запросах (например, доля успешных поисковых сессий, Precision@K / Recall@K) по оценке пользователей/экспертов.

## 9. Связанные документы

- Бизнес‑описание продукта: `docs/product-overview.md`
- Архитектура и пайплайн: `docs/architecture.md`, `docs/pipeline.md`
- Контракты форматов данных: `docs/contracts/*.schema.json`

Примечание (MVP): на первом этапе доступ потребителей к результатам реализуется через **CLI‑экспорт файлов**; API/веб‑интерфейсы — возможное развитие.

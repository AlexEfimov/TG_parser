# Ingestion Pipeline – TG_parser

## Общий поток

1. Планировщик выбирает Telegram‑каналы и диапазон времени.
2. Модуль Ingestion загружает сообщения и формирует объекты `RawTelegramMessage`.
3. Модуль Processing преобразует `RawTelegramMessage` в `ProcessedDocument`.
4. Модуль Storage сохраняет/обновляет `KnowledgeBaseEntry` в базе знаний и, при необходимости, в индексах поиска.

## Шаги подробно

### 1. Планировщик
- Триггеры: периодический запуск, ручной запуск, обновление за последний интервал.
- Идемпотентность: хранение «последнего обработанного» сообщения/offset по каналу.

### 2. Ingestion (Telegram)
- Используемый клиент/библиотека Telegram (будет уточнено в ADR).
- Учёт лимитов API и ретраи при ошибках.
- Дедупликация сообщений и нормализация временных меток.
- Результат: список `RawTelegramMessage`.

### 3. Processing (LLM)
- Предобработка текста: очистка, нормализация, детекция языка.
- Вызовы LLM/моделей для:
  - классификации по темам;
  - извлечения сущностей;
  - генерации краткого описания.
- Формирование `ProcessedDocument` по схеме.

### 4. Storage / Knowledge Base
- Преобразование `ProcessedDocument` → `KnowledgeBaseEntry`.
- Upsert по устойчивому идентификатору (канал + message_id).
- Обновление индексов (например, векторный или полнотекстовый поиск).

## Взаимодействие с другими системами

- Источники: Telegram‑каналы (публичные или с доступом).
- Потребители: сервисы, использующие базу знаний (поиск, аналитика, ассистенты).


